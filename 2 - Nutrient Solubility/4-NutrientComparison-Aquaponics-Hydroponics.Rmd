---
title: "Aquaponics versus Hydroponics"
subtitle: "Comparison of nutrient concentrations recommended for hydroponics with their maximum solubilities under aquaponic conditions"
author: "Anıl A. Tellbüscher"
date: '2022-07-07'
output: html_document
---

# General
Conditions in aquaponic systems differ from those in hydroponics. The main differences with regards to physicochemical conditions are

- pH
- DOM


The question arising is now whether the recommended elemental concentrations for hydroponic nutrient solutions can actually be reached in aquaponic systems from a chemical viewpoint or whether precipitation occurs due to the higher pH in the system.




```{r}
library(XLConnect)
library(tidyverse)
```


# 1. Hydroponic data

## 1.1 Load data
```{r Resh Workbook loading}
# Load Workbook
resh_hydroponic_plant_production <- loadWorkbook(filename = "/Users/anil/Library/CloudStorage/OneDrive-JihočeskáuniverzitavČeskýchBudějovicích/General/Resh - Hydroponic Plant Production.xlsx")
```



```{r Resh Workbook reading}
# Read Worksheet
# Unit: mg/L
resh_data <- readWorksheet(resh_hydroponic_plant_production, sheet = "nutrient solutions", region = c('A', 'C2:Q50'))
```



```{r Molar weight data}
molarWeight <- read.csv2('data/molarWeight.csv')
```



## 1.2 Data wrangling
```{r}
resh_data <- data.frame(resh_data[[2]], row.names = resh_data[[1]][2:49,1])

resh_data <- resh_data %>% 
  rename('P' = 'PO4_P_mgL', 'K' = 'K_mgL', 'Ca' = 'Ca_mgL', 'Mg' = 'Mg_mgL', 'S' = 'SO4_S_mgL', 'B' = 'B_mgL', 'Fe' = 'Fe_mgL', 'Mn' = 'Mn_mgL', 'Cu' = 'Cu_mgL', 'Zn' = 'Zn_mgL', 'Na' = 'Na_mgL', 'NH4' = 'NH4_N_mgL', 'Mo' = 'Mo_mgL', 'NO3' = 'NO3_N_mgL', 'Cl' = 'Cl_mgL') 

print(resh_data)
```



## 1.3 Create dataset with target concentrations in hydroponics
```{r}
targetConc <- resh_data %>% 
  
  # Calculate total N
  mutate(
    N = NH4 + NO3
  ) %>% 
  select(-c('NH4', 'NO3')) %>% 
  
  # Create longtable
  pivot_longer(
    everything(),
    names_to = 'nutrient',
    values_to = 'concentration'
    ) %>% 
  
  # Remove missing values
  drop_na() %>% 
  group_by(nutrient) %>% 
  summarise(mean_mgL = mean(concentration)) %>% 
  left_join(molarWeight, by = c('nutrient' = 'element')) %>% 
  mutate(
    g_per_mol = as.numeric(g_per_mol),
    mean_molL = mean_mgL * g_per_mol * 1e-3) %>% 
  arrange(desc(mean_molL)) %>% 
  print()
```  



## 1.4 Consideration of environmental aspects
Due to the fact that conditions in hydroponic systems differ from those observed in aquaculture, some assumptions can be made such as the pH being maintained at acidic levels. Furthermore, it can be assumed that the $CO_{2}$ saturation of the water is likely comparably high because no gas stripping technology is applied and in some greenhouses the atmospheric $CO_{2}$ concentration is even artificially increased.

|Variable   |Assumption|
|-----------|----------|
|pH         |6.0       |
|$p(CO_{2})$|0.54 atm  |

```{r include=FALSE}
pH <- 6
```



It is generally assumed that the pH ranges around an average 6.0, while the atmospheric concentration of $CO_{2}$ is 0.54 atm. The correction of the concentrations for pH can be done using self-written speciation functions.

```{r Load correction functions}
# PO4
source('R/speciation - c_T-PO4.R')

source('R/speciation - OH.R')

source('R/speciation - pCO2-CO3.R')

source('R/speciation - c_T-SO4.R')
```



Eventually, the functions can be applied to the dataset.

```{r}
targetConc %>%
  select(c(nutrient, mean_molL)) %>% 
  pivot_wider(names_from = 'nutrient', values_from = 'mean_molL') %>% 
  
  # Calculate species
  mutate(
    species_PO4 = calc_PO4(c_tot = P, pH = pH, form_P = 'po4-p', unit = 'mol'),
    
    species_OH = calc_OH(pH = pH),
    
    species_CO3 = calc_CO3(pH = pH, pCO2 = 0.054)
  )
```



The next step after the pH correction is to calculate theoretical lowest ('worst case') solubilities of all compounds.

```{r}
read.csv('data/solubilityData_for4-NutrientComparison.csv')
```

