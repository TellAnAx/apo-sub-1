---
title: "Aquaponics versus Hydroponics"
subtitle: "Comparison of nutrient concentrations recommended for hydroponics with their maximum solubilities under aquaponic conditions"
author: "Anıl A. Tellbüscher"
date: '2022-07-07'
output: html_document
---

# General
Conditions in aquaponic systems differ from those in hydroponics. The main differences with regards to physicochemical conditions are

- pH
- DOM

The question arising is now whether the recommended elemental concentrations for hydroponic nutrient solutions can actually be reached in aquaponic systems from a chemical viewpoint or whether precipitation occurs due to the higher pH in the system.




```{r}
library(XLConnect)
library(tidyverse)
```


# 1. Hydroponic data

## 1.1 Load data
```{r Resh Workbook loading}
# Load Workbook
resh_hydroponic_plant_production <- loadWorkbook(filename = "/Users/anil/Library/CloudStorage/OneDrive-JihočeskáuniverzitavČeskýchBudějovicích/General/Resh - Hydroponic Plant Production.xlsx")
```



```{r Resh Workbook reading}
# Read Worksheet
# Unit: mg/L
resh_data <- readWorksheet(resh_hydroponic_plant_production, sheet = "nutrient solutions", region = c('A', 'C2:Q50'))
```



```{r Molar weight data}
molarWeight <- read.csv2('data/molarWeight.csv')
```



## 1.2 Data wrangling
```{r}
resh_data <- data.frame(resh_data[[2]], row.names = resh_data[[1]][2:49,1])

resh_data <- resh_data %>% 
  rename('P' = 'PO4_P_mgL', 'K' = 'K_mgL', 'Ca' = 'Ca_mgL', 'Mg' = 'Mg_mgL', 'S' = 'SO4_S_mgL', 'B' = 'B_mgL', 'Fe' = 'Fe_mgL', 'Mn' = 'Mn_mgL', 'Cu' = 'Cu_mgL', 'Zn' = 'Zn_mgL', 'Na' = 'Na_mgL', 'NH4' = 'NH4_N_mgL', 'Mo' = 'Mo_mgL', 'NO3' = 'NO3_N_mgL', 'Cl' = 'Cl_mgL') 

print(resh_data)
```



## 1.3 Create dataset with target concentrations in hydroponics
```{r}
targetConc <- resh_data %>% 
  
  # Calculate total N
  mutate(
    N = NH4 + NO3
  ) %>% 
  select(-c('NH4', 'NO3')) %>% 
  
  # Create longtable
  pivot_longer(
    everything(),
    names_to = 'nutrient',
    values_to = 'concentration'
    ) %>% 
  
  # Remove missing values
  drop_na() %>% 
  group_by(nutrient) %>% 
  summarise(mean_mgL = mean(concentration)) %>% 
  left_join(molarWeight, by = c('nutrient' = 'element')) %>% 
  mutate(
    g_per_mol = as.numeric(g_per_mol),
    mean_molL = mean_mgL * g_per_mol * 1e-3) %>% 
  arrange(desc(mean_molL)) %>% 
  print()
```  